<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AsyncCache Demo | Next-Gen PHP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
</head>
<body class="ui grey basic segment" style="min-height: 100vh; margin: 0;">

<!-- Navigation Menu -->
<div class="ui inverted teal top fixed menu">
    <div class="ui container">
        <a class="header item">
            <i class="bolt icon"></i>
            AsyncCache PHP
        </a>
        <a href="/dashboard" class="active item">
            <i class="home icon"></i>
            Basic Demo
        </a>
        <a href="/benchmark" class="item">
            <i class="chart bar icon"></i>
            Multi-Cache Benchmark
        </a>
        <div class="right menu">
            <a class="item" href="https://github.com/alerts-in-ua/async-cache-php" target="_blank">
                <i class="github icon"></i>
                GitHub
            </a>
        </div>
    </div>
</div>

<div class="ui container" style="margin-top: 70px; margin-bottom: 40px;">
    
    <!-- Header Section -->
    <div class="ui inverted teal raised padded segment">
        <div class="ui stackable grid middle aligned">
            <div class="ten wide column">
                <h1 class="ui inverted header">
                    <i class="bolt icon"></i>
                    <div class="content">
                        AsyncCache PHP
                        <div class="sub header">Next-Gen Asynchronous Caching (ReactPHP + Fibers)</div>
                    </div>
                </h1>
            </div>
            <div class="six wide column right aligned">
                <div class="ui horizontal inverted small statistics">
                    <div class="statistic">
                        <div class="value">8.2</div>
                        <div class="label">PHP</div>
                    </div>
                    <div class="statistic">
                        <div class="value"><i class="bolt icon"></i></div>
                        <div class="label">Active</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Breadcrumb -->
    <div class="ui breadcrumb segment" style="background: white;">
        <a class="section">Examples</a>
        <i class="right angle icon divider"></i>
        <div class="active section">Basic Demo</div>
    </div>

    <!-- Stats Section -->
    <div class="ui doubling three statistics segment basic">
        <div class="teal statistic">
            <div class="value" id="stats-hits">0</div>
            <div class="label"><i class="save icon"></i> Hits (Cache)</div>
        </div>
        <div class="orange statistic">
            <div class="value" id="stats-misses">0</div>
            <div class="label"><i class="cloud download icon"></i> Misses (Requests)</div>
        </div>
        <div class="blue statistic">
            <div class="value" id="stats-total">0</div>
            <div class="label"><i class="chart line icon"></i> Total</div>
        </div>
    </div>

    <!-- Actions and Log Section -->
    <div class="ui stackable grid">
        <div class="eleven wide column">
            <div class="ui raised padded segment">
                <h3 class="ui header">
                    <i class="rocket icon"></i>
                    Performance Testing
                </h3>
                
                <div class="ui two column stackable grid">
                    <div class="column">
                        <button id="btn-slow" class="ui fluid teal labeled icon button massive">
                            <i class="world icon"></i>
                            Heavy Request
                        </button>
                        <div class="ui bottom attached warning message">
                            <i class="info circle icon"></i> API Request (2-3 sec)
                        </div>
                    </div>
                    <div class="column">
                        <button id="btn-fast" class="ui fluid blue labeled icon button massive">
                            <i class="lightning icon"></i>
                            Fast Request
                        </button>
                        <div class="ui bottom attached positive message">
                            <i class="check icon"></i> Non-blocking Response
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Log -->
            <div class="ui inverted segment">
                <div class="ui top attached teal label">System Log</div>
                <div id="log-container" class="ui list" style="height: 280px; overflow-y: auto; font-family: monospace; font-size: 13px; padding: 10px;">
                    <div class="item" style="color: #888;">[System] Demo initialized. Awaiting commands...</div>
                </div>
            </div>
        </div>

        <!-- Result Sidebar -->
        <div class="five wide column">
            <div class="ui fluid card">
                <div class="content">
                    <div class="header">Last Result</div>
                </div>
                <div id="flag-display" class="ui image middle aligned" style="background: #f3f3f3; height: 180px; display: flex; align-items: center; justify-content: center; padding: 10px;">
                    <i class="huge grey image outline icon"></i>
                </div>
                <div class="extra content" id="flag-status">
                    <span class="right floated" id="status-label">None</span>
                    <span><i class="history icon"></i> Status</span>
                </div>
            </div>

            <div class="ui segment">
                <h4 class="ui header">Tech Stack</h4>
                <div class="ui relaxed divided list">
                    <div class="item">
                        <i class="large green check middle aligned icon"></i>
                        <div class="content">
                            <div class="header">ReactPHP</div>
                            <div class="description">Event Loop</div>
                        </div>
                    </div>
                    <div class="item">
                        <i class="large green check middle aligned icon"></i>
                        <div class="content">
                            <div class="header">Fibers</div>
                            <div class="description">Concurrency</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Card -->
            <div class="ui card">
                <div class="content">
                    <div class="header"><i class="compass icon"></i> More Examples</div>
                </div>
                <div class="content">
                    <div class="ui link list">
                        <a href="/benchmark" class="item">
                            <i class="chart bar icon"></i>
                            Multi-Cache Benchmark
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
<script>
    function addLog(msg, type = 'info') {
        const time = new Date().toLocaleTimeString();
        let color = '#00ff00';
        if (type === 'warning') color = '#f2711c';
        if (type === 'error') color = '#db2828';
        if (type === 'success') color = '#54c8ff';
        const line = `<div class="item"><span style="color: #666">[${time}]</span> <span style="color: ${color}">${msg}</span></div>`;
        const container = $('#log-container');
        container.append(line).scrollTop(container[0].scrollHeight);
    }

    function updateStats() {
        $.getJSON('/api/stats', function(data) {
            $('#stats-hits').text(data.hits);
            $('#stats-misses').text(data.misses);
            $('#stats-total').text(data.hits + data.misses);
        });
    }

    $('#btn-slow').click(function() {
        const btn = $(this);
        btn.addClass('loading disabled');
        addLog('Sending request to RestCountries API...', 'info');
        
        $.getJSON('/api/slow', function(res) {
            btn.removeClass('loading disabled');
            
            let statusHtml = '';
            let logType = 'info';
            
            if (res.source === 'stale_fallback') {
                statusHtml = '<span class="ui orange tiny label">STALE</span>';
                logType = 'warning';
                addLog('⚠️ API ERROR! Stale data returned from cache.', 'warning');
            } else if (res.source === 'cache') {
                statusHtml = '<span class="ui teal tiny label">CACHE</span>';
                logType = 'success';
            } else {
                statusHtml = '<span class="ui green tiny label">FRESH</span>';
            }

            if (res.data) {
                addLog(`Flag received. Time: ${res.latency}s`, 'success');
                $('#flag-display').html(`<img src="${res.data}" class="ui centered image" style="max-height: 100%; width: auto; object-fit: contain;">`);
                $('#status-label').html(statusHtml);
            }
            
            updateStats();
        }).fail(function(err) {
            btn.removeClass('loading disabled');
            addLog('❌ CRITICAL FAILURE: Network unreachable', 'error');
            $('#flag-display').html('<i class="huge red exclamation triangle icon"></i>');
            $('#status-label').html('<span class="ui red tiny label">ERROR</span>');
        });
    });

    $('#btn-fast').click(function() {
        const start = Date.now();
        $.getJSON('/api/fast', function(res) {
            const duration = (Date.now() - start);
            addLog(`RESPONSE: ${res.data} (${duration}ms)`, 'success');
            updateStats();
        });
    });

    setInterval(updateStats, 2000);
</script>
</body>
</html>
