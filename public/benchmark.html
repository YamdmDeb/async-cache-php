<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Cache Benchmark | AsyncCache PHP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
</head>
<body class="ui grey basic segment" style="min-height: 100vh; margin: 0;">

<!-- Navigation Menu -->
<div class="ui inverted teal top fixed menu">
    <div class="ui container">
        <a class="header item">
            <i class="bolt icon"></i>
            AsyncCache PHP
        </a>
        <a href="/dashboard" class="item">
            <i class="home icon"></i>
            Basic Demo
        </a>
        <a href="/benchmark" class="active item">
            <i class="chart bar icon"></i>
            Multi-Cache Benchmark
        </a>
        <div class="right menu">
            <a class="item" href="https://github.com/alerts-in-ua/async-cache-php" target="_blank">
                <i class="github icon"></i>
                GitHub
            </a>
        </div>
    </div>
</div>

<div class="ui container" style="margin-top: 70px; margin-bottom: 40px;">
    
    <!-- Header Section -->
    <div class="ui inverted teal raised padded segment">
        <div class="ui stackable grid middle aligned">
            <div class="ten wide column">
                <h1 class="ui inverted header">
                    <i class="chart bar icon"></i>
                    <div class="content">
                        Multi-Cache Benchmark
                        <div class="sub header">Concurrent Testing (ReactPHP + Fibers + Layered Cache)</div>
                    </div>
                </h1>
            </div>
            <div class="six wide column right aligned">
                <div class="ui horizontal inverted small statistics">
                    <div class="statistic">
                        <div class="value">8.2</div>
                        <div class="label">PHP</div>
                    </div>
                    <div class="statistic">
                        <div class="value"><i class="layer group icon"></i></div>
                        <div class="label">L1+L2</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Breadcrumb -->
    <div class="ui breadcrumb segment" style="background: white;">
        <a class="section">Examples</a>
        <i class="right angle icon divider"></i>
        <div class="active section">Multi-Cache Benchmark</div>
    </div>

    <!-- Stats Section -->
    <div class="ui doubling four statistics segment basic">
        <div class="teal statistic">
            <div class="value" id="stats-memory-total">0</div>
            <div class="label"><i class="memory icon"></i> Memory Total</div>
        </div>
        <div class="blue statistic">
            <div class="value" id="stats-chain-total">0</div>
            <div class="label"><i class="layer group icon"></i> Chain Total</div>
        </div>
        <div class="orange statistic">
            <div class="value" id="stats-memory-avg">0ms</div>
            <div class="label"><i class="clock icon"></i> Memory Avg</div>
        </div>
        <div class="purple statistic">
            <div class="value" id="stats-chain-avg">0ms</div>
            <div class="label"><i class="clock icon"></i> Chain Avg</div>
        </div>
    </div>

    <!-- Actions and Log Section -->
    <div class="ui stackable grid">
        <div class="eleven wide column">
            <div class="ui raised padded segment">
                <h3 class="ui header">
                    <i class="rocket icon"></i>
                    Concurrency Testing
                </h3>
                
                <div class="ui two column stackable grid">
                    <div class="column">
                        <button id="btn-memory" class="ui fluid teal labeled icon button massive">
                            <i class="memory icon"></i>
                            Memory (L1)
                        </button>
                        <div class="ui bottom attached positive message">
                            <i class="lightning icon"></i> 10 Concurrent Requests (In-Memory)
                        </div>
                    </div>
                    <div class="column">
                        <button id="btn-chain" class="ui fluid blue labeled icon button massive">
                            <i class="layer group icon"></i>
                            Chain (L1+L2)
                        </button>
                        <div class="ui bottom attached warning message">
                            <i class="world icon"></i> 10 Concurrent Requests (Memory + Network)
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Log -->
            <div class="ui inverted segment">
                <div class="ui top attached teal label">System Log</div>
                <div id="log-container" class="ui list" style="height: 280px; overflow-y: auto; font-family: monospace; font-size: 13px; padding: 10px;">
                    <div class="item" style="color: #888;">[System] Benchmark ready. Choose cache strategy...</div>
                </div>
            </div>
        </div>

        <!-- Result Sidebar -->
        <div class="five wide column">
            <div class="ui fluid card">
                <div class="content">
                    <div class="header">Active Tests</div>
                </div>
                <div class="content" style="min-height: 180px;">
                    <div class="ui tiny statistics">
                        <div class="teal statistic">
                            <div class="value" id="active-memory">0</div>
                            <div class="label">Memory</div>
                        </div>
                        <div class="blue statistic">
                            <div class="value" id="active-chain">0</div>
                            <div class="label">Chain</div>
                        </div>
                    </div>
                    <div class="ui divider"></div>
                    <div class="ui relaxed list">
                        <div class="item">
                            <i class="bolt icon"></i>
                            <div class="content">
                                <div class="description" id="status-memory">Ready</div>
                            </div>
                        </div>
                        <div class="item">
                            <i class="layer group icon"></i>
                            <div class="content">
                                <div class="description" id="status-chain">Ready</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ui segment">
                <h4 class="ui header">Cache Layers</h4>
                <div class="ui relaxed divided list">
                    <div class="item">
                        <i class="large teal memory middle aligned icon"></i>
                        <div class="content">
                            <div class="header">L1 Cache</div>
                            <div class="description">In-Memory</div>
                        </div>
                    </div>
                    <div class="item">
                        <i class="large blue database middle aligned icon"></i>
                        <div class="content">
                            <div class="header">L2 Cache</div>
                            <div class="description">Network (~50ms)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Card -->
            <div class="ui card">
                <div class="content">
                    <div class="header"><i class="compass icon"></i> More Examples</div>
                </div>
                <div class="content">
                    <div class="ui link list">
                        <a href="/dashboard" class="item">
                            <i class="home icon"></i>
                            Basic Demo
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
<script>
    let memoryStats = { total: 0, times: [] };
    let chainStats = { total: 0, times: [] };

    function addLog(msg, type = 'info') {
        const time = new Date().toLocaleTimeString();
        let color = '#00ff00';
        if (type === 'warning') color = '#f2711c';
        if (type === 'error') color = '#db2828';
        if (type === 'success') color = '#54c8ff';
        if (type === 'teal') color = '#00b5ad';
        if (type === 'blue') color = '#2185d0';
        
        const line = `<div class="item"><span style="color: #666">[${time}]</span> <span style="color: ${color}">${msg}</span></div>`;
        const container = $('#log-container');
        container.append(line).scrollTop(container[0].scrollHeight);
    }

    function updateStats() {
        $('#stats-memory-total').text(memoryStats.total);
        $('#stats-chain-total').text(chainStats.total);
        
        const memAvg = memoryStats.times.length > 0 
            ? Math.round(memoryStats.times.reduce((a,b) => a+b, 0) / memoryStats.times.length)
            : 0;
        const chainAvg = chainStats.times.length > 0 
            ? Math.round(chainStats.times.reduce((a,b) => a+b, 0) / chainStats.times.length)
            : 0;
        
        $('#stats-memory-avg').text(memAvg + 'ms');
        $('#stats-chain-avg').text(chainAvg + 'ms');
    }

    function runBenchmark(endpoint, label, color, statsObj, statusId, activeId) {
        const btn = $(label === 'Memory' ? '#btn-memory' : '#btn-chain');
        btn.addClass('loading disabled');
        
        addLog(`ðŸš€ Launching 10 concurrent requests for ${label}...`, color);
        $(statusId).text('Running...');
        
        let completed = 0;
        let active = 10;
        $(activeId).text(active);
        
        for (let i = 1; i <= 10; i++) {
            (function(index) {
                const start = Date.now();
                $.getJSON(endpoint, function(res) {
                    const duration = (Date.now() - start);
                    statsObj.total++;
                    statsObj.times.push(duration);
                    
                    addLog(`[${label}] Request #${index} completed: ${res.latency}s (${duration}ms)`, color);
                    
                    completed++;
                    active--;
                    $(activeId).text(active);
                    
                    if (completed === 10) {
                        btn.removeClass('loading disabled');
                        $(statusId).text('Complete âœ“');
                        addLog(`âœ… ${label} batch finished!`, 'success');
                        updateStats();
                    }
                }).fail(function() {
                    completed++;
                    active--;
                    $(activeId).text(active);
                    addLog(`âŒ [${label}] Request #${index} failed`, 'error');
                    
                    if (completed === 10) {
                        btn.removeClass('loading disabled');
                        $(statusId).text('Error âœ—');
                        updateStats();
                    }
                });
            })(i);
        }
    }

    $('#btn-memory').click(function() {
        runBenchmark('/api/memory', 'Memory', 'teal', memoryStats, '#status-memory', '#active-memory');
    });

    $('#btn-chain').click(function() {
        runBenchmark('/api/chain', 'Chain', 'blue', chainStats, '#status-chain', '#active-chain');
    });

    $('#active-memory, #active-chain').text('0');
</script>
</body>
</html>
